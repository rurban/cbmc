<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CBMC: Memory Predicates</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CBMC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('contracts-memory-predicates.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Memory Predicates </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md101">Syntax</a><ul><li class="level2"><a href="#autotoc_md102">Parameters</a></li>
<li class="level2"><a href="#autotoc_md103">Return Value</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md104">Semantics</a><ul><li class="level2"><a href="#autotoc_md105">Enforcement</a></li>
<li class="level2"><a href="#autotoc_md106">Replacement</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md107">Additional Resources</a></li>
</ul>
</div>
<div class="textblock"><p>Back to <a class="el" href="contracts-user.html">Code Contracts User Documentation</a></p>
<h1><a class="anchor" id="autotoc_md101"></a>
Syntax</h1>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> <a class="code" href="cprover__builtin__headers_8h.html#ad4e9673ed79a6d8ff4af6cf12d95c29f">__CPROVER_is_fresh</a>(<span class="keywordtype">void</span> *p, <span class="keywordtype">size_t</span> size);</div>
</div><!-- fragment --><p>To specify memory footprint we use a special function called <code>__CPROVER_is_fresh</code>. The meaning of <code>__CPROVER_is_fresh</code> is that we are borrowing a pointer from the external environment (in a precondition), or returning it to the calling context (in a postcondition).</p>
<h2><a class="anchor" id="autotoc_md102"></a>
Parameters</h2>
<p><code>__CPROVER_is_fresh</code> takes two arguments: a pointer and an allocation size. The first argument is the pointer to be checked for "freshness" (i.e., not previously allocated), and the second is the expected size in bytes for the memory available at the pointer. <br  />
</p>
<h2><a class="anchor" id="autotoc_md103"></a>
Return Value</h2>
<p>It returns a <code>bool</code> value, indicating whether the pointer is fresh.</p>
<h1><a class="anchor" id="autotoc_md104"></a>
Semantics</h1>
<p>To illustrate the semantics for <code>__CPROVER_is_fresh</code>, consider the following implementation of <code>sum</code> function.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> *err_signal; <span class="comment">// Global variable</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> sum(<span class="keyword">const</span> uint32_t a, <span class="keyword">const</span> uint32_t b, uint32_t* out)</div>
<div class="line">__CPROVER_requires(<a class="code" href="cprover__builtin__headers_8h.html#ad4e9673ed79a6d8ff4af6cf12d95c29f">__CPROVER_is_fresh</a>(out, <span class="keyword">sizeof</span>(*out)))</div>
<div class="line">__CPROVER_ensures(<a class="code" href="cprover__builtin__headers_8h.html#ad4e9673ed79a6d8ff4af6cf12d95c29f">__CPROVER_is_fresh</a>(err_signal, <span class="keyword">sizeof</span>(*err_signal)))</div>
<div class="line">__CPROVER_assigns(*out, err_signal)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> uint64_t result = ((uint64_t) a) + ((uint64_t) b);</div>
<div class="line">  err_signal = malloc(<span class="keyword">sizeof</span>(*err_signal));</div>
<div class="line">  <span class="keywordflow">if</span> (!err_signal) <span class="keywordflow">return</span>;</div>
<div class="line">  <span class="keywordflow">if</span> (result &gt; UINT32_MAX) *err_signal = FAILURE;</div>
<div class="line">  *out = (uint32_t) result;</div>
<div class="line">  *err_signal = SUCCESS;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md105"></a>
Enforcement</h2>
<p>When checking the contract abstracts a function a <code>__CPROVER_is_fresh</code> in a <em>requires</em> clause will cause fresh memory to be allocated. In an <em>ensures</em> clause it will check that memory was freshly allocated.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> *err_signal; <span class="comment">// Global variable</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> __CPROVER_contracts_original_sum(<span class="keyword">const</span> uint32_t a, <span class="keyword">const</span> uint32_t b, uint32_t* out)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> uint64_t result = ((uint64_t) a) + ((uint64_t) b);</div>
<div class="line">  err_signal = malloc(<span class="keyword">sizeof</span>(*err_signal));</div>
<div class="line">  <span class="keywordflow">if</span> (!err_signal) <span class="keywordflow">return</span>;</div>
<div class="line">  <span class="keywordflow">if</span> (result &gt; UINT32_MAX) *err_signal = FAILURE;</div>
<div class="line">  *out = (uint32_t) result;</div>
<div class="line">  *err_signal = SUCCESS;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Function Contract Enforcement */</span></div>
<div class="line"><span class="keywordtype">int</span> sum(<span class="keyword">const</span> uint32_t a, <span class="keyword">const</span> uint32_t b, uint32_t* out)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="cprover__builtin__headers_8h.html#ae5af07e274b573cd0f23ffb9d332bef2">__CPROVER_assume</a>(<a class="code" href="cprover__builtin__headers_8h.html#ad4e9673ed79a6d8ff4af6cf12d95c29f">__CPROVER_is_fresh</a>(out, <span class="keyword">sizeof</span>(*out))); <span class="comment">// Assumes out is freshly allocated</span></div>
<div class="line">  <span class="keywordtype">int</span> return_value_sum = __CPROVER_contracts_original_sum(a, b, out);</div>
<div class="line">  <a class="code" href="cprover__builtin__headers_8h.html#a564e8a5a7bebea04fdd5ee1277832478">__CPROVER_assert</a>(<a class="code" href="cprover__builtin__headers_8h.html#ad4e9673ed79a6d8ff4af6cf12d95c29f">__CPROVER_is_fresh</a>(err_signal, <span class="keyword">sizeof</span>(*err_signal)), <span class="stringliteral">&quot;Check ensures clause&quot;</span>);</div>
<div class="line">  <span class="keywordflow">return</span> return_value_sum;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md106"></a>
Replacement</h2>
<p>In our example, consider that a function <code>foo</code> may call <code>sum</code>.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> *err_signal; <span class="comment">// Global variable</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> foo()</div>
<div class="line">{</div>
<div class="line">  uint32_t a;</div>
<div class="line">  uint32_t b;</div>
<div class="line">  uint32_t out;</div>
<div class="line">  sum(a, b, &amp;out);</div>
<div class="line">  <span class="keywordflow">return</span> *err_signal;</div>
<div class="line">}</div>
</div><!-- fragment --><p>When using a contract as an abstraction in place of a call to the function a <code>__CPROVER_is_fresh</code> in a <em>requires</em> clause will check that the argument supplied is fresh and <code>__CPROVER_is_fresh</code> in an <em>ensures</em> clause will result in a fresh malloc.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> *err_signal; <span class="comment">// Global variable</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> foo()</div>
<div class="line">{</div>
<div class="line">  uint32_t a;</div>
<div class="line">  uint32_t b;</div>
<div class="line">  uint32_t out;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Function Contract Replacement */</span></div>
<div class="line">  <span class="comment">/* Precondition */</span></div>
<div class="line">  <a class="code" href="cprover__builtin__headers_8h.html#a564e8a5a7bebea04fdd5ee1277832478">__CPROVER_assert</a>(<a class="code" href="cprover__builtin__headers_8h.html#ad4e9673ed79a6d8ff4af6cf12d95c29f">__CPROVER_is_fresh</a>(out, <span class="keyword">sizeof</span>(*out)), <span class="stringliteral">&quot;Check requires clause&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Writable Set */</span></div>
<div class="line">  *(&amp;out) = nondet_uint32_t();</div>
<div class="line">  err_signal = nondet_int_pointer();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Postconditions */</span></div>
<div class="line">  <a class="code" href="cprover__builtin__headers_8h.html#ae5af07e274b573cd0f23ffb9d332bef2">__CPROVER_assume</a>(<a class="code" href="cprover__builtin__headers_8h.html#ad4e9673ed79a6d8ff4af6cf12d95c29f">__CPROVER_is_fresh</a>(err_signal, <span class="keyword">sizeof</span>(*err_signal))); <span class="comment">// Assumes out is allocated</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> *err_signal;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md107"></a>
Additional Resources</h1>
<ul>
<li><a class="el" href="contracts-functions.html">Function Contracts</a><ul>
<li><a class="el" href="contracts-requires-ensures.html">Requires and Ensures Clauses</a></li>
<li><a class="el" href="contracts-assigns.html">Assigns Clauses</a></li>
<li><a class="el" href="contracts-frees.html">Frees Clauses</a></li>
</ul>
</li>
<li><a class="el" href="contracts-loops.html">Loop Contracts</a><ul>
<li><a class="el" href="contracts-loop-invariants.html">Loop Invariant Clauses</a></li>
<li><a class="el" href="contracts-decreases.html">Decreases Clauses</a></li>
<li><a class="el" href="contracts-assigns.html">Assigns Clauses</a></li>
<li><a class="el" href="contracts-frees.html">Frees Clauses</a></li>
</ul>
</li>
<li><a class="el" href="contracts-memory-predicates.html">Memory Predicates</a></li>
<li><a class="el" href="contracts-function-pointer-predicates.html">Function Pointer Predicates</a></li>
<li><a class="el" href="contracts-history-variables.html">History Variables</a></li>
<li><a class="el" href="contracts-quantifiers.html">Quantifiers</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="acprover__builtin__headers_8h_html_ad4e9673ed79a6d8ff4af6cf12d95c29f"><div class="ttname"><a href="cprover__builtin__headers_8h.html#ad4e9673ed79a6d8ff4af6cf12d95c29f">__CPROVER_is_fresh</a></div><div class="ttdeci">__CPROVER_bool __CPROVER_is_fresh(const void *mem, __CPROVER_size_t size)</div></div>
<div class="ttc" id="acprover__builtin__headers_8h_html_ae5af07e274b573cd0f23ffb9d332bef2"><div class="ttname"><a href="cprover__builtin__headers_8h.html#ae5af07e274b573cd0f23ffb9d332bef2">__CPROVER_assume</a></div><div class="ttdeci">void __CPROVER_assume(__CPROVER_bool assumption)</div></div>
<div class="ttc" id="acprover__builtin__headers_8h_html_a564e8a5a7bebea04fdd5ee1277832478"><div class="ttname"><a href="cprover__builtin__headers_8h.html#a564e8a5a7bebea04fdd5ee1277832478">__CPROVER_assert</a></div><div class="ttdeci">void __CPROVER_assert(__CPROVER_bool assertion, const char *description)</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="contracts-mainpage.html">Code Contracts in CBMC</a></li><li class="navelem"><a class="el" href="contracts-user.html">Code Contracts User Documentation</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
