<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CProver manual: contracts-invariants</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CProver manual
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">contracts-invariants </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href=".">CPROVER Manual TOC</a></p>
<h1><a class="anchor" id="invariant-clauses"></a>
Invariant Clauses</h1>
<p>An <em>invariant</em> clause specifies a property that must be preserved by every iteration of a loop. In general a loop has infinitely many invariants. For instance, <code>true</code> is a trivial invariant that holds before the loop, and after each iteration of the loop (thus, inductive). However, <code>true</code> is rarely useful â€“ it is an extremely imprecise abstraction of a loop, which is generally not <em>sufficient</em> to prove any subsequent assertions.</p>
<h3><a class="anchor" id="syntax"></a>
Syntax</h3>
<p>An <em>invariant</em> clause accepts a valid Boolean expression over the variables visible at the same scope as the loop. Additionally, <a class="el" href="md_contracts-history-variables.html">history variables</a> are also allowed within invariant clauses.</p>
<div class="fragment"><div class="line">__CPROVER_loop_invariant(bool cond)</div>
</div><!-- fragment --><p>Invariant clauses may be specified just after the loop guard. Multiple invariant clauses on the same loop are allowed, and is equivalent to a single invariant clause that is a conjunction of those clauses. A few examples are shown below.</p>
<div class="fragment"><div class="line">while(i &lt; n)</div>
<div class="line">__CPROVER_loop_invariant(0 &lt;= i &amp;&amp; i &lt;= n)</div>
<div class="line">{ ... }</div>
</div><!-- fragment --><div class="fragment"><div class="line">for(int i = 0; i &lt; n; ++i)</div>
<div class="line">__CPROVER_loop_invariant(0 &lt;= i)</div>
<div class="line">__CPROVER_loop_invariant(i &lt;= n)</div>
<div class="line">{ ... }</div>
</div><!-- fragment --><div class="fragment"><div class="line">do { ... }</div>
<div class="line">while (i &lt; n)</div>
<div class="line">__CPROVER_loop_invariant(0 &lt;= i)</div>
<div class="line">__CPROVER_loop_invariant(i &lt;= n);</div>
</div><!-- fragment --><p><b>Important.</b> Invariant clauses must be free of <em>side effects</em>, for example, mutation of local or global variables. Otherwise, CBMC raises an error message during compilation: </p><pre class="fragment">Loop invariant is not side-effect free. (at: file main.c line 4 function main) 
</pre><h3><a class="anchor" id="semantics"></a>
Semantics</h3>
<p>A loop invariant clause expands to several assumptions and assertions: 1. The invariant is <em>asserted</em> just before the first iteration. 2. The invariant is <em>assumed</em> on a non-deterministic state to model a non-deterministic iteration. 3. The invariant is finally <em>asserted</em> again to establish its inductiveness.</p>
<p>Mathematical induction is the working principle here. (1) establishes the base case for induction, and (2) &amp; (3) establish the inductive case. Therefore, the invariant must hold <em>after</em> the loop execution for <em>any</em> number of iterations. The invariant, together with the negation of the loop guard, must be sufficient to establish subsequent assertions. If it is not, the abstraction is too imprecise and the user must supply a stronger invariant.</p>
<p>To illustrate the key idea, consider the following <a href="https://en.wikipedia.org/wiki/Binary_search_algorithm">binary search</a> loop with invariant clauses:</p>
<div class="fragment"><div class="line">int binary_search(int val, int *buf, int size)</div>
<div class="line">{</div>
<div class="line">  if(size &lt;= 0 || buf == NULL) return NOT_FOUND;</div>
<div class="line"> </div>
<div class="line">  long long lb = 0, ub = size - 1;</div>
<div class="line">  long long mid = ((unsigned int)lb + (unsigned int)ub) &gt;&gt; 1;</div>
<div class="line"> </div>
<div class="line">  while(lb &lt;= ub)</div>
<div class="line">  __CPROVER_loop_invariant(0L &lt;= lb &amp;&amp; lb - 1L &lt;= ub &amp;&amp; ub &lt; size)</div>
<div class="line">  __CPROVER_loop_invariant(mid == ((unsigned int)lb + (unsigned int)ub) &gt;&gt; 1)</div>
<div class="line">  {</div>
<div class="line">     if(buf[mid] == val) break;</div>
<div class="line">     if(buf[mid] &lt; val)</div>
<div class="line">       lb = mid + 1;</div>
<div class="line">     else</div>
<div class="line">       ub = mid - 1;</div>
<div class="line">     mid = ((unsigned int)lb + (unsigned int)ub) &gt;&gt; 1;</div>
<div class="line">  }</div>
<div class="line">  return lb &gt; ub ? NOT_FOUND : mid;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The instrumented GOTO program is conceptually similar to the following high-level C program:</p>
<div class="fragment"><div class="line">int binary_search(int val, int *buf, int size)</div>
<div class="line">{</div>
<div class="line">  if(size &lt;= 0 || buf == NULL) return NOT_FOUND;</div>
<div class="line"> </div>
<div class="line">  long long lb = 0, ub = size - 1;</div>
<div class="line">  long long mid = ((unsigned int)lb + (unsigned int)ub) &gt;&gt; 1;</div>
<div class="line"> </div>
<div class="line">  /* 1. assert invariant at loop entry */</div>
<div class="line">  assert(0L &lt;= lb &amp;&amp; lb - 1L &lt;= ub &amp;&amp; ub &lt; size);</div>
<div class="line">  assert(mid == ((unsigned int)lb + (unsigned int)ub) &gt;&gt; 1);</div>
<div class="line"> </div>
<div class="line">  /* 2. create a non-deterministic state for modified variables */</div>
<div class="line">  havoc(lb, ub, mid);</div>
<div class="line"> </div>
<div class="line">  /* 3. establish invariant to model state at an arbitrary iteration */</div>
<div class="line">  __CPROVER_assume(0L &lt;= lb &amp;&amp; lb - 1L &lt;= ub &amp;&amp; ub &lt; size);</div>
<div class="line">  __CPROVER_assume(mid == ((unsigned int)lb + (unsigned int)ub) &gt;&gt; 1);</div>
<div class="line"> </div>
<div class="line">  /* 4. perform a single arbitrary iteration (or exit the loop) */</div>
<div class="line">  if(lb &lt;= ub)</div>
<div class="line">  {</div>
<div class="line">    if(buf[mid] == val) break;</div>
<div class="line">    if(buf[mid] &lt; val)</div>
<div class="line">      lb = mid + 1;</div>
<div class="line">    else</div>
<div class="line">      ub = mid - 1;</div>
<div class="line">    mid = ((unsigned int)lb + (unsigned int)ub) &gt;&gt; 1;</div>
<div class="line"> </div>
<div class="line">    /* 5. assert the invariant to establish inductiveness */</div>
<div class="line">    assert(0L &lt;= lb &amp;&amp; lb - 1L &lt;= ub &amp;&amp; ub &lt; size);</div>
<div class="line">    assert(mid == ((unsigned int)lb + (unsigned int)ub) &gt;&gt; 1);</div>
<div class="line"> </div>
<div class="line">    /* 6. terminate this symbolic execution path; similar to &quot;exit&quot; */</div>
<div class="line">    __CPROVER_assume(false);</div>
<div class="line">  }</div>
<div class="line">  return lb &gt; ub ? NOT_FOUND : mid;</div>
<div class="line">}</div>
</div><!-- fragment --><p>A few things to note here:</p>
<ul>
<li>At instrumented code point (2), when we <code>havoc</code> the modified variables, this set of modified variables is automatically computed using alias analysis of l-values appearing in the loop body. However, the analysis is incomplete and may fail to characterize the set for complex loops. In such cases, the user must manually annotate the set of modified variables using an <a class="el" href="md_contracts-assigns.html">*assigns clause*</a>.</li>
<li>At instrumented code point (6), when we <em>assume</em> <code>false</code>, observe that this assumption only exists within the <code>lb &lt;= ub</code> conditional. Therefore, only the symbolic execution path <em>inside</em> this conditional block terminates. The code outside of the conditional block continues to be symbolically executed, and subsequent assertions do not become vacuously <code>true</code>.</li>
</ul>
<p>Last modified: 2022-10-25 10:34:29 +0200 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
